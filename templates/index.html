<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>主神空間 — 無限輪迴 RPG</title>
  <link rel="stylesheet" href="/static/style.css?v={{ v }}">
</head>
<body>
  <!-- Header -->
  <header id="header">
    <button id="drawer-toggle-btn" title="故事/分支管理">&#x2630;</button>
    <div class="header-title">
      <span class="header-icon">&#x2726;</span>
      <span class="header-title-full">主神空間 — 無限輪迴 RPG</span>
      <span class="header-title-short">無限輪迴</span>
    </div>
    <div class="header-sub">諸天無限流 · 文字冒險</div>
    <div id="branch-indicator" class="branch-indicator"></div>
    <div id="world-day-display"></div>
    <span id="cheat-badge">金手指</span>
    <span id="pistol-badge">手槍</span>
    <a href="/lore" class="header-lore-link" title="世界設定知識庫">&#x1F4D6;</a>
  </header>

  <!-- Drawer overlay -->
  <div id="drawer-overlay" class="hidden"></div>

  <!-- Slide-out Drawer -->
  <aside id="drawer" class="closed">
    <div class="drawer-header">
      <h2>管理面板</h2>
      <button id="drawer-close-btn" title="關閉">&times;</button>
    </div>

    <!-- Story section -->
    <div class="drawer-section">
      <div class="drawer-section-title">
        <span>&#x1F4D6; 故事</span>
        <button id="new-story-btn" class="drawer-add-btn" title="建立新故事">+</button>
      </div>
      <div id="story-list" class="drawer-list">
        <!-- populated by JS -->
      </div>
    </div>

    <!-- Branch section -->
    <div class="drawer-section">
      <div class="drawer-section-title">
        <span>&#x1F500; 分支</span>
        <div class="drawer-btn-group">
          <button id="branch-tree-btn" class="drawer-add-btn" title="分支樹全覽">&#x1F333;</button>
          <button id="new-blank-branch-btn" class="drawer-add-btn" title="新建空白分支（全新開始）">⊕</button>
        </div>
      </div>
      <div id="branch-list" class="drawer-list">
        <!-- populated by JS -->
      </div>
    </div>

    <!-- Summary section (auto-play only) -->
    <div class="drawer-section" id="summary-section" style="display:none;">
      <div class="drawer-section-title"><span>&#x1F4CA; 遊玩摘要</span></div>
      <div id="summary-metrics"></div>
      <div id="summary-timeline"></div>
    </div>

    <!-- Game Saves section -->
    <div class="drawer-section">
      <div class="drawer-section-title">
        <span>&#x1F4BE; 遊戲存檔</span>
        <button id="create-save-btn" class="drawer-add-btn" title="建立存檔">+</button>
      </div>
      <div id="saves-list" class="drawer-list">
        <!-- populated by JS -->
      </div>
    </div>

    <!-- Character Status section -->
    <div class="drawer-section">
      <div class="drawer-section-title">
        <span>&#x1F9D9; 角色狀態</span>
      </div>
      <div id="char-panel">
        <!-- Dynamically generated by JS based on character_schema -->
      </div>
    </div>

    <!-- NPC section -->
    <div class="drawer-section">
      <div class="drawer-section-title">
        <span>&#x1F465; NPC 角色</span>
      </div>
      <div id="npc-panel">
        <!-- Dynamically generated by JS -->
      </div>
    </div>

    <!-- Events section -->
    <div class="drawer-section">
      <div class="drawer-section-title">
        <span>&#x1F4CB; 事件追蹤</span>
      </div>
      <div id="events-panel">
        <!-- Dynamically generated by JS -->
      </div>
    </div>

    <!-- Settings section -->
    <div class="drawer-section">
      <div class="drawer-section-title"><span>&#x2699;&#xFE0F; 設定</span></div>
      <div id="config-panel">
        <div class="config-field">
          <label>LLM 提供者</label>
          <select id="provider-select"></select>
        </div>
        <div class="config-field">
          <label>模型</label>
          <select id="model-select"></select>
        </div>
        <div class="config-field cheat-field">
          <label>骰子必勝</label>
          <button id="dice-cheat-btn" class="cheat-toggle" onclick="toggleDiceCheat()">OFF</button>
        </div>
      </div>
    </div>
  </aside>

  <div id="app">
    <!-- Main chat area -->
    <main id="chat-area">
      <div id="messages">
        <button id="load-earlier" style="display:none;">載入更早的訊息</button>
        <div id="message-list"></div>
        <div id="loading-indicator" style="display:none;">
          <div class="typing-dots">
            <span></span><span></span><span></span>
          </div>
          <span>主神系統處理中…</span>
        </div>
      </div>

      <div id="input-area">
        <div id="input-area-inner">
          <textarea id="user-input" placeholder="輸入你的行動…" rows="1"></textarea>
          <button id="send-btn">&#10148;</button>
        </div>
        <button id="addon-panel-btn" title="附加功能" aria-haspopup="true" aria-expanded="false">&#x2699;</button>
        <div id="addon-panel" class="addon-panel hidden">
          <div class="addon-section">
            <div class="addon-section-title">模型選擇</div>
            <div class="addon-field">
              <select id="addon-model-combined"></select>
            </div>
          </div>
          <div class="addon-section">
            <div class="addon-section-title">金手指</div>
            <div class="addon-toggle-field">
              <span>骰子必勝</span>
              <button id="addon-dice-btn" class="cheat-toggle" onclick="toggleAddonDiceCheat()">OFF</button>
            </div>
          </div>
          <div class="addon-section">
            <div class="addon-section-title">手槍模式</div>
            <div class="addon-toggle-field">
              <span>啟用</span>
              <div class="addon-pistol-controls">
                <button id="addon-pistol-btn" class="cheat-toggle" onclick="togglePistolMode()">OFF</button>
                <button id="addon-pistol-prefs-btn" class="pistol-prefs-btn hidden" onclick="openPistolPrefsModal()" title="偏好設定">&#x2699;</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- New Story Modal -->
  <div id="new-story-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <h2>建立新故事</h2>
      <div class="modal-field">
        <label for="ns-name">故事名稱 *</label>
        <input type="text" id="ns-name" placeholder="例：末日修仙錄">
      </div>
      <div class="modal-field">
        <label for="ns-desc">描述</label>
        <input type="text" id="ns-desc" placeholder="簡短說明故事背景">
      </div>
      <div class="modal-field">
        <label for="ns-prompt">System Prompt</label>
        <textarea id="ns-prompt" rows="8" placeholder="GM 指令（可包含 {character_state} 等 placeholder）"></textarea>
      </div>
      <div class="modal-field">
        <label for="ns-schema">角色 Schema (JSON)</label>
        <textarea id="ns-schema" rows="6" placeholder='{"fields": [...], "lists": [...], "direct_overwrite_keys": [...]}'></textarea>
      </div>
      <div class="modal-field">
        <label for="ns-state">初始角色狀態 (JSON)</label>
        <textarea id="ns-state" rows="4" placeholder='{"name": "角色名"}'></textarea>
      </div>
      <div class="modal-actions">
        <button id="ns-cancel" class="modal-cancel-btn">取消</button>
        <button id="ns-create" class="modal-create-btn">建立</button>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div id="confirm-modal" class="modal-overlay hidden">
    <div class="modal-content confirm-modal-box">
      <p id="confirm-modal-msg"></p>
      <div class="modal-actions">
        <button id="confirm-modal-cancel" class="modal-cancel-btn">取消</button>
        <button id="confirm-modal-ok" class="modal-danger-btn">確定刪除</button>
      </div>
    </div>
  </div>

  <!-- Alert Modal -->
  <div id="alert-modal" class="modal-overlay hidden">
    <div class="modal-content confirm-modal-box">
      <p id="alert-modal-msg"></p>
      <div class="modal-actions">
        <button id="alert-modal-ok" class="modal-create-btn">確定</button>
      </div>
    </div>
  </div>

  <!-- Prompt Modal -->
  <div id="prompt-modal" class="modal-overlay hidden">
    <div class="modal-content confirm-modal-box">
      <p id="prompt-modal-msg"></p>
      <input type="text" id="prompt-modal-input" class="prompt-modal-input" autocomplete="off">
      <div class="modal-actions">
        <button id="prompt-modal-cancel" class="modal-cancel-btn">取消</button>
        <button id="prompt-modal-ok" class="modal-create-btn">確定</button>
      </div>
    </div>
  </div>

  <!-- Summary Timeline Modal -->
  <div id="summary-modal" class="modal-overlay hidden">
    <div class="modal-content summary-modal-content">
      <div class="summary-modal-header">
        <h2>遊玩摘要</h2>
        <div id="summary-modal-metrics" class="summary-modal-metrics"></div>
        <button id="summary-modal-close" class="summary-modal-close-btn">&times;</button>
      </div>
      <div id="summary-modal-timeline" class="summary-modal-body"></div>
    </div>
  </div>

  <!-- Branch Tree Modal -->
  <div id="branch-tree-modal" class="modal-overlay hidden">
    <div class="modal-content branch-tree-modal-content">
      <div class="branch-tree-modal-header">
        <h2>分支樹</h2>
        <div id="bt-toolbar" class="bt-toolbar">
          <button id="bt-continue-btn" class="bt-toolbar-btn bt-continue hidden" title="繼續上次遊玩">&#x25B6; 繼續</button>
          <button id="bt-select-toggle" class="bt-toolbar-btn" title="多選模式">&#x2610;</button>
          <button id="bt-delete-selected" class="bt-toolbar-btn bt-danger hidden" title="刪除選取">&#x2715; 刪除</button>
          <button id="bt-merge-selected" class="bt-toolbar-btn bt-merge hidden" title="合併選取">&#x2934; 合併</button>
        </div>
        <button id="branch-tree-modal-close" class="summary-modal-close-btn">&times;</button>
      </div>
      <div id="branch-tree-container" class="branch-tree-container"></div>
    </div>
  </div>

  <!-- Pistol Prefs Modal -->
  <div id="pistol-prefs-modal" class="modal-overlay hidden">
    <div class="modal-content pistol-prefs-modal-content">
      <div class="pistol-prefs-header">
        <h2>偏好設定</h2>
        <button id="pistol-prefs-close" class="summary-modal-close-btn">&times;</button>
      </div>
      <div class="pistol-prefs-body">
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">風格</div>
          <div class="pistol-chips" data-group="style">
            <button class="pistol-chip" data-value="浪漫">浪漫<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="激烈">激烈<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="溫柔">溫柔<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="粗暴">粗暴<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="慢節奏">慢節奏<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="挑逗">挑逗<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="禁忌">禁忌<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="野性">野性<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="純愛">純愛<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="背德">背德<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="SM">SM<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="調教">調教<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="NTR">NTR<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="偷情">偷情<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="初體驗">初體驗<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="醉酒迷濛">醉酒迷濛<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="半夢半醒">半夢半醒<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="強制">強制<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="催眠">催眠<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="痴漢">痴漢<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="癡女">癡女<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip-add" data-group="style" title="新增">+</button>
          </div>
        </div>
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">體位</div>
          <div class="pistol-chips" data-group="positions">
            <button class="pistol-chip" data-value="正常位">正常位<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="後入">後入<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="騎乘">騎乘<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="側入">側入<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="站立">站立<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="69式">69式<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="背後抱">背後抱<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="壁咚">壁咚<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="跪趴">跪趴<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="坐姿">坐姿<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="懸空抱">懸空抱<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="對面坐">對面坐<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="老漢推車">老漢推車<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="抬腿">抬腿<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="倒騎">倒騎<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="趴在桌上">趴在桌上<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="靠牆">靠牆<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip-add" data-group="positions" title="新增">+</button>
          </div>
        </div>
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">前戲/技巧</div>
          <div class="pistol-chips" data-group="foreplay">
            <button class="pistol-chip" data-value="前戲">前戲<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="愛撫">愛撫<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="接吻">接吻<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="舌吻">舌吻<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="耳語">耳語<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="舔耳">舔耳<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="種草莓">種草莓<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="指交">指交<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="口交">口交<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="深喉">深喉<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="舔舐">舔舐<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="乳交">乳交<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="足交">足交<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="按摩">按摩<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="乳首愛撫">乳首愛撫<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="肛交">肛交<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="打屁股">打屁股<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="咬痕">咬痕<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="窒息play">窒息play<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="顏面騎乘">顏面騎乘<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="乳頭夾">乳頭夾<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip-add" data-group="foreplay" title="新增">+</button>
          </div>
        </div>
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">高潮/結束</div>
          <div class="pistol-chips" data-group="climax">
            <button class="pistol-chip" data-value="內射">內射<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="顏射">顏射<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="口爆">口爆<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="吞精">吞精<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="潮吹">潮吹<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="同時高潮">同時高潮<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="多次高潮">多次高潮<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="高潮控制">高潮控制<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="射在身上">射在身上<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="連續絕頂">連續絕頂<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="失禁">失禁<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="高潮痙攣">高潮痙攣<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="強制高潮">強制高潮<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip-add" data-group="climax" title="新增">+</button>
          </div>
        </div>
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">道具/情境</div>
          <div class="pistol-chips" data-group="props">
            <button class="pistol-chip" data-value="跳蛋">跳蛋<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="按摩棒">按摩棒<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="眼罩">眼罩<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="繩縛">繩縛<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="項圈">項圈<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="皮鞭">皮鞭<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="蠟燭">蠟燭<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="冰塊">冰塊<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="制服">制服<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="絲襪">絲襪<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="角色扮演">角色扮演<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="手銬">手銬<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="口球">口球<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="肛塞">肛塞<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="潤滑液">潤滑液<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="鏡子前">鏡子前<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="攝影">攝影<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="電話中">電話中<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="食物play">食物play<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip-add" data-group="props" title="新增">+</button>
          </div>
        </div>
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">場景</div>
          <div class="pistol-chips" data-group="scene">
            <button class="pistol-chip" data-value="浴室">浴室<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="溫泉">溫泉<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="野外">野外<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="車內">車內<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="公共場所">公共場所<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="偷窺">偷窺<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="露出">露出<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="多人">多人<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="辦公室">辦公室<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="教室">教室<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="更衣室">更衣室<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="電梯">電梯<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="泳池">泳池<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="旅館">旅館<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="帳篷">帳篷<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="廁所">廁所<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip-add" data-group="scene" title="新增">+</button>
          </div>
        </div>
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">描寫重點</div>
          <div class="pistol-chips" data-group="focus">
            <button class="pistol-chip" data-value="情感互動">情感互動<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="肉體描寫">肉體描寫<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="對話呻吟">對話呻吟<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="氛圍營造">氛圍營造<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="表情特寫">表情特寫<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="體液描寫">體液描寫<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="事後餘韻">事後餘韻<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="內心獨白">內心獨白<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="羞恥感">羞恥感<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="征服感">征服感<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="背德快感">背德快感<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="身體顫抖">身體顫抖<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="理性崩壞">理性崩壞<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip-add" data-group="focus" title="新增">+</button>
          </div>
        </div>
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">角色動態</div>
          <div class="pistol-chips" data-group="dynamic">
            <button class="pistol-chip" data-value="玩家主導">玩家主導<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="對方主導">對方主導<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="雙方主動">雙方主動<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="欲拒還迎">欲拒還迎<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="誘惑">誘惑<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="服從">服從<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="強勢壓制">強勢壓制<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="嬌羞">嬌羞<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="央求">央求<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="命令">命令<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="撒嬌">撒嬌<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="挑釁">挑釁<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="哭泣求饒">哭泣求饒<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip" data-value="口嫌體正直">口嫌體正直<span class="chip-delete">&times;</span></button>
            <button class="pistol-chip-add" data-group="dynamic" title="新增">+</button>
          </div>
        </div>
        <div class="pistol-chips-group">
          <div class="pistol-chips-label">自訂補充</div>
          <textarea id="pistol-custom-prefs" rows="2" placeholder="額外描述（可選）…"></textarea>
        </div>
      </div>
      <div class="modal-actions">
        <button id="pistol-prefs-save" class="modal-create-btn" onclick="savePistolPrefs()">儲存</button>
      </div>
    </div>
  </div>

  <script src="/static/app.js?v={{ v }}"></script>
</body>
</html>

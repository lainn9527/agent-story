<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>世界設定知識庫</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/lore.css">
</head>
<body class="lore-page">
  <!-- Header -->
  <header id="lore-header">
    <a href="/" class="header-back" title="返回遊戲">&#x2190; 返回遊戲</a>
    <div class="header-title">
      <span class="header-icon">&#x2726;</span>
      世界設定知識庫
    </div>
    <div id="story-name" class="header-sub"></div>
  </header>

  <!-- Mobile tabs -->
  <div id="mobile-tabs">
    <button class="mobile-tab active" data-panel="list">設定列表</button>
    <button class="mobile-tab" data-panel="chat">AI 對話</button>
  </div>

  <!-- Main two-panel layout -->
  <div id="lore-container">
    <!-- Left panel: Lore list -->
    <div id="lore-list-panel" class="panel">
      <div class="panel-toolbar">
        <input type="text" id="lore-search" placeholder="搜尋設定..." />
        <button id="lore-toggle-all-btn" title="全部展開/收起">&#x25BC;</button>
        <button id="lore-add-btn" title="新增設定">+ 新增</button>
      </div>
      <div id="batch-bar" class="batch-bar hidden">
        <span id="batch-count"></span>
        <button id="batch-delete-btn" class="btn-danger">刪除所選</button>
        <button id="batch-clear-btn" class="btn-secondary">取消選取</button>
      </div>
      <div id="lore-list" class="panel-body">
        <!-- Populated by JS -->
      </div>
    </div>

    <!-- Right panel: Chat -->
    <div id="lore-chat-panel" class="panel hidden-mobile">
      <div id="chat-messages" class="panel-body">
        <div class="chat-msg assistant">
          <div class="chat-msg-content"><p>歡迎使用世界設定管理助手。你可以：</p><ul><li>詢問現有設定的細節或矛盾</li><li>請我幫你新增、修改或刪除設定</li><li>討論設定間的一致性</li></ul><p>變更會即時同步到遊戲中，影響 GM 的下一次回覆。<br>有什麼我能幫忙的嗎？</p></div>
        </div>
      </div>
      <div id="chat-input-area">
        <textarea id="chat-input" placeholder="輸入訊息... (Ctrl+Enter 送出)" rows="2"></textarea>
        <button id="chat-stop-btn" class="hidden" title="停止輸出">停止</button>
        <button id="chat-send-btn" title="送出">送出</button>
      </div>
    </div>
  </div>

  <!-- Edit modal -->
  <div id="edit-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">編輯設定</h3>
        <button id="modal-close" class="modal-close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <label>分類</label>
        <select id="modal-category"></select>
        <label>主題</label>
        <input type="text" id="modal-topic" />
        <label>內容</label>
        <textarea id="modal-content" rows="12"></textarea>
      </div>
      <div class="modal-footer">
        <button id="modal-delete" class="btn-danger" style="display:none;">刪除</button>
        <div class="modal-footer-right">
          <button id="modal-cancel" class="btn-secondary">取消</button>
          <button id="modal-save" class="btn-primary">儲存</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.4/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@15.0.7/marked.min.js"></script>
  <script src="/static/lore.js"></script>
</body>
</html>
